(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9bd3939c"],{"139b":function(t,e,i){"use strict";i("9a87")},"6c2b":function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"d",(function(){return c})),i.d(e,"e",(function(){return a})),i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return o})),i.d(e,"f",(function(){return l}));i("99af");var n=i("41cb");function s(t){return Object(n.$cms)()({method:"GET",url:"/api/cms/post/collection/".concat(t)})}function c(t){return Object(n.$cms)()({method:"GET",url:"/api/cms/post/collection/mine",params:t})}function o(t){return Object(n.$cms)().post("/api/cms/post/collection",t)}function l(t,e){return Object(n.$cms)().put("/api/cms/post/collection/".concat(t),e)}function a(t){return Object(n.$cms)().delete("/api/cms/post/collection/".concat(t))}function r(t){return Object(n.$cms)().post("/api/cms/post/".concat(t.post_type,"-").concat(t.post_id,"/append-to-collection/").concat(t.post_collection),{title:t.post_title})}},"9a87":function(t,e,i){},abe2:function(t,e,i){"use strict";i("d810")},d810:function(t,e,i){},ef77:function(t,e,i){"use strict";i("b0c0"),i("14d9");var n={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}},s=(i("abe2"),i("2877")),c=Object(s.a)(n,(function(){var t=this._self._c;return t("div",{staticClass:"m-publish-header"},[t("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=c.exports},f0d2:function(t,e,i){"use strict";i.d(e,"i",(function(){return s})),i.d(e,"a",(function(){return c})),i.d(e,"f",(function(){return o})),i.d(e,"h",(function(){return l})),i.d(e,"g",(function(){return a})),i.d(e,"d",(function(){return r})),i.d(e,"c",(function(){return u})),i.d(e,"b",(function(){return p})),i.d(e,"e",(function(){return d}));i("99af");var n=i("41cb");function s(t){return Object(n.$next)().post("/api/face/file-upload",t)}function c(t){return Object(n.$next)().post("/api/face",t)}function o(t){return Object(n.$next)().get("/api/face/".concat(t))}function l(t,e){return Object(n.$next)().put("/api/face/".concat(t),e)}function a(t){return Object(n.$next)().get("/api/face/my-list",{params:t})}function r(t){return Object(n.$next)().get("/api/face",{params:t})}function u(t){return Object(n.$next)().put("/api/face/".concat(t,"/online"))}function p(t){return Object(n.$next)().put("/api/face/".concat(t,"/offline"))}function d(t){return Object(n.$next)().get("/api/charge_attachment/face/".concat(t,"/edit"))}},f1e8:function(t,e,i){"use strict";i.r(e);i("a434"),i("498a"),i("a4d3"),i("e01a");var n=i("b85c"),s=(i("ac1f"),i("1276"),i("14d9"),i("13d5"),i("d3b7"),i("b64b"),i("e9c4"),i("65c2")),c=i("221a"),o=i("47b9"),l=i("ef77"),a=i("b76a"),r=i.n(a),u=i("6c2b"),p=i("29c2"),d=i("f0d2"),f=i("85e4"),b=i("2ef0"),m=i.n(b),h={name:"collection",props:[],data:function(){var t=Object.assign({custom:"自定义"},s.__postType,s.__wikiType,{face:"捏脸"});return delete t.jx3dat,delete t.notice,{source_types:t,public:o.a,collection:{id:"",title:"",public:1,image:"",description:"",tags:[],posts:[]},tag:"",legal_tags:null,show_description:!0,processing:!1}},computed:{id:function(){return this.$route.params.collection_id}},methods:{tags_filters:function(t){var e,i=[],s=Object(n.a)(this.legal_tags);try{for(s.s();!(e=s.n()).done;){var c=e.value;c.split(t).length>1&&i.push({value:c})}}catch(t){s.e(t)}finally{s.f()}return i},title_fill:function(t,e){var i=e.posts[t];e.title=i&&i.title?i.title:""},add_posts_item:function(){this.collection.posts.push({title:"",type:"",id:"",url:"",posts:null})},search_handle:function(t,e){null===t&&(e.id=t=""),"face"===e.type?Object(d.d)({title:t}).then((function(t){var i;e.posts=(null===(i=t.data.data.list)||void 0===i?void 0:i.reduce((function(t,e){return t[e.id]={id:e.id,title:e.title,type:"face"},t}),{}))||{}})):Object(p.b)(e.type,{public:1,keyword:t}).then((function(t){200===(t=t.data).code&&(e.posts=t.data.posts)}))},init:function(){var t=this;Object(u.c)(this.id).then((function(e){var i=e.data.data;if(i){for(var n in i.posts){var s=i.posts[n];i.posts[n].posts="custom"===s.type?null:[{id:s.id,title:s.title}]}t.collection=i}else t.$message({message:"该剑三小册已被删除或无权限访问",type:"warning"})}))},submit:function(){var t=this,e=JSON.parse(JSON.stringify(this.collection));e.posts||(e.posts=[]),console.log(e);var i="";for(var n in e.posts){var s=e.posts[n];if(!s.type){i="文章类型不能为空哦";break}if(!s.id){i="请选择对应的文章";break}if(!s.title){i="请填写自定义链接的标题";break}if(!s.url){i="请填写正确的小册文章链接（http或https开头）";break}}if(i)this.$message({message:i,type:"warning"});else{for(var c in e.posts)delete e.posts[c].posts;e.posts=JSON.stringify(e.posts),this.processing=!0;var o="";this.id?(e=m.a.pick(e,["title","public","image","description","mark","posts"]),o=Object(u.f)(this.id,e)):(e=m.a.omit(e,["id","tags"]),o=Object(u.b)(e)),o.then((function(e){t.$message({message:t.id?"更新成功":"创建成功",type:"success"});var i=t.id||e.data.data.id;setTimeout((function(){location.href=Object(f.getLink)("collection",i)}),500)})).finally((function(){t.processing=!1}))}}},watch:{id:{immediate:!0,handler:function(t){t&&this.init()}}},components:{Tinymce:c.a,draggable:r.a,"publish-header":l.a}},v=(i("139b"),i("2877")),_=Object(v.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-box"},[e("publish-header",{attrs:{name:"剑三小册",localDraft:!1}},[t._t("header")],2),e("el-form",{staticClass:"m-publish-collection",attrs:{"label-position":"left"}},[e("div",{staticClass:"m-publish-title"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("标题")]),e("el-input",{attrs:{placeholder:"请输入小册标题",maxlength:"30","show-word-limit":""},model:{value:t.collection.title,callback:function(e){t.$set(t.collection,"title",e)},expression:"collection.title"}})],1),e("div",{staticClass:"m-publish-primary"},[e("div",{staticClass:"m-publish-primary-block"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("可见性")]),e("el-radio",{attrs:{label:this.public.PUBLIC},model:{value:t.collection.public,callback:function(e){t.$set(t.collection,"public",t._n(e))},expression:"collection.public"}},[t._v("公开")]),e("el-radio",{attrs:{label:this.public.PRIVATE},model:{value:t.collection.public,callback:function(e){t.$set(t.collection,"public",t._n(e))},expression:"collection.public"}},[t._v("私有")])],1),e("div",{staticClass:"m-publish-primary-block m-publish-collection-posts"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("内容")]),t.collection.posts&&t.collection.posts.length?e("draggable",{staticClass:"m-list-style",attrs:{tag:"ul",list:t.collection.posts,handle:".u-move"}},t._l(t.collection.posts,(function(i,n){return e("li",{key:n,staticClass:"c-posts-item"},[e("i",{staticClass:"u-move el-icon-more"}),e("i",{staticClass:"u-delete el-icon-close",on:{click:function(e){return t.collection.posts.splice(n,1)}}}),e("el-row",{staticClass:"m-posts-item",attrs:{gutter:10}},[e("el-col",{staticClass:"u-collection-type",attrs:{span:4}},[e("el-select",{staticClass:"u-item-key",attrs:{placeholder:"请选择作品类型"},on:{change:function(){t.search_handle(null,i),i.url=i.title=""}},model:{value:i.type,callback:function(e){t.$set(i,"type",e)},expression:"item.type"}},t._l(t.source_types,(function(t,i){return e("el-option",{key:i,attrs:{label:t,value:i}})})),1)],1),e("el-col",{staticClass:"u-collection-id",attrs:{span:8}},["custom"!==i.type?e("el-select",{staticClass:"u-item-value",attrs:{filterable:"",remote:"",placeholder:"通过输入作品标题进行搜索","remote-method":function(e){t.search_handle(e,i)}},on:{change:function(e){t.title_fill(e,i)}},model:{value:i.id,callback:function(e){t.$set(i,"id",e)},expression:"item.id"}},[t._l(i.posts,(function(i){return[i.id&&i.title?e("el-option",{key:i.id,attrs:{value:i.id,label:i.title}}):t._e()]}))],2):e("el-input",{staticClass:"u-item-value",attrs:{placeholder:"请输入完整网页链接（需以HTTP或HTTPS开头）"},model:{value:i.url,callback:function(e){t.$set(i,"url","string"==typeof e?e.trim():e)},expression:"item.url"}})],1),i.url?e("el-col",{staticClass:"u-collection-url",attrs:{span:12}},[e("el-input",{attrs:{placeholder:"请输入自定义标题"},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"item.title"}})],1):t._e()],1)],1)})),0):e("div",{staticClass:"u-posts-items-empty"},[t._v("暂无作品信息，请进行作品添加")]),e("div",{staticClass:"u-posts-add",on:{click:t.add_posts_item}},[e("i",{staticClass:"el-icon-plus"}),e("span",[t._v("添加作品")])])],1),e("div",{staticClass:"m-publish-primary-block m-publish-description"},[e("el-divider",{attrs:{"content-position":"left"},on:{click:function(e){t.show_description=!t.show_description}}},[t._v("描述（选填）")]),t.show_description?t._e():e("span",{staticClass:"u-show",on:{click:function(e){t.show_description=!0}}},[t._v("▼ 展开")]),t.show_description?e("span",{staticClass:"u-hide",on:{click:function(e){t.show_description=!1}}},[t._v("▲ 收起")]):t._e(),e("Tinymce",{directives:[{name:"show",rawName:"v-show",value:t.show_description,expression:"show_description"}],attrs:{attachmentEnable:!0,resourceEnable:!0,height:300},model:{value:t.collection.description,callback:function(e){t.$set(t.collection,"description",e)},expression:"collection.description"}})],1)]),e("div",{staticClass:"m-publish-collection-publish"},[e("el-button",{staticClass:"u-button",attrs:{type:"primary",loading:t.processing,disabled:t.processing},on:{click:t.submit}},[t._v("发    布")])],1)])],1)}),[],!1,null,"61fe0980",null);e.default=_.exports}}]);
//# sourceMappingURL=chunk-9bd3939c.68fc9321.js.map