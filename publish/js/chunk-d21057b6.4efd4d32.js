(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-d21057b6"],{1:function(t,e){},"60ee":function(t,e,n){"use strict";n("9989")},9989:function(t,e,n){},abe2:function(t,e,n){"use strict";n("d810")},d7d8:function(t,e,n){"use strict";n.r(e);n("b0c0"),n("a434"),n("d3b7"),n("498a"),n("14d9");var s=n("ef77"),i=n("221a"),o=n("1b86"),a=n("c9d2"),l=n("41cb"),c=n("4328"),r=n.n(c);function u(t){return Object(l.$helper)()({method:"GET",url:"/api/knowledges",params:t})}var d={name:"knowledge",data:function(){return{action:"new",isEditMode:!1,types:[],options:{sources:[],loading:!1},knowledge:{type:"",name:""},currentSource:"",processing:!1,post:{id:"",content:"",source_id:"",remark:"",tags:[]},inputVisible:!1,inputValue:""}},computed:{source_id:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.source_id},client:function(){return this.$store.state.client}},methods:{loadData:function(t){var e=this;t&&o.a.get({type:"knowledge",id:t},{supply:0}).then((function(t){var n,s,i,o,a=null===(n=t.data)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.source;e.currentSource=null==a?void 0:a.name,e.post.source_id=null==a?void 0:a.id;var l=null===(i=t.data)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.post;e.post.content=(null==l?void 0:l.content)||"",e.post.tags=(null==l?void 0:l.tags)||[]}))},loadTypes:function(){var t=this;Object(l.$helper)()({method:"GET",url:"/api/knowledge/menus"}).then((function(e){t.types=e.data.data.menus}))},loadSources:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.options.loading=!0,u({keyword:e,include_pending:1,limit:10}).then((function(e){t.options.sources=e.data.data.data})).finally((function(){t.options.loading=!1}))},resetSource:function(){"new"==this.action&&(this.post.source_id="",this.currentSource="",this.post.content="",this.post.tags=[],this.post.remark="")},handleSubmit:function(){var t=this;"new"!=this.action||this.post.source_id?this.createPost():this.createSource().then((function(){t.createPost()}))},createSource:function(){var t,e=this;return this.processing=!0,(t={type:this.knowledge.type,name:this.knowledge.name,client:"all"},Object(l.$helper)()({method:"POST",url:"/api/knowledge",data:r.a.stringify({knowledge:t})})).then((function(t){e.post.source_id=t.data.data.id})).finally((function(){e.processing=!1}))},selectSource:function(t){this.loadData(t)},validate:function(){var t=this,e=["source_id","content","remark"].every((function(e){return!!t.post[e]}));return e||this.$message.error("请完成必填项"),e},createPost:function(){var t=this;if(this.validate()){this.processing=!0;var e={source_id:String(this.post.source_id),user_nickname:a.a.getInfo().name,content:this.post.content,remark:this.post.remark,tags:this.post.tags};o.a.post({type:"knowledge",data:e,client:"all"},{}).then((function(e){200===(e=e.data).code?t.$message({message:"提交成功，请等待审核",type:"success"}):t.$message({message:"".concat(e.message),type:"warning"})})).finally((function(){t.processing=!1}))}},handleInputConfirm:function(){var t=this.inputValue.trim();t&&this.post.tags.push(t),this.inputVisible=!1,this.inputValue=""},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick((function(e){t.$refs.saveTagInput.$refs.input.focus()}))}},watch:{"$route.params.source_id":{immediate:!0,handler:function(t){t?(this.action="update",this.isEditMode=!0,this.post.source_id=~~t,this.loadData(t)):(this.action="new",this.loadTypes(),this.loadSources())}},action:{handler:function(){this.isEditMode||this.resetSource()}},source_id:function(t){this.loadData(t)}},components:{"publish-header":s.a,Tinymce:i.a}},p=(n("60ee"),n("2877")),h=Object(p.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-box"},[e("publish-header",{attrs:{name:"通识百科"}},[t._t("header")],2),e("el-form",{staticClass:"m-publish-post"},[e("div",{staticClass:"m-publish-source"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("选择通识 *")]),e("el-radio-group",{staticClass:"m-publish-action",model:{value:t.action,callback:function(e){t.action=e},expression:"action"}},[e("el-radio-button",{attrs:{label:"new",disabled:t.isEditMode}},[t._v("新建词条")]),e("el-radio-button",{attrs:{label:"update"}},[t._v("维护已有词条")])],1),t.isEditMode?e("el-input",{staticClass:"u-current-source",attrs:{disabled:""},model:{value:t.currentSource,callback:function(e){t.currentSource=e},expression:"currentSource"}}):["new"==t.action?[e("div",{staticClass:"u-create-source"},[e("el-select",{staticClass:"u-source-type",attrs:{placeholder:"选择通识类型"},model:{value:t.knowledge.type,callback:function(e){t.$set(t.knowledge,"type",e)},expression:"knowledge.type"}},t._l(t.types,(function(t){return e("el-option",{key:t.name,attrs:{value:t.name,label:t.label}})})),1),e("el-input",{staticClass:"u-source-name",attrs:{placeholder:"请输入通识名称"},model:{value:t.knowledge.name,callback:function(e){t.$set(t.knowledge,"name",e)},expression:"knowledge.name"}})],1),e("p",{staticClass:"u-source-add-tip"},[e("span",[t._v("Note：添加完成后的通识需要经过管理员审核通过后才会在通识百科上展示哦")])])]:[e("el-select",{staticClass:"u-source-id",attrs:{filterable:"",remote:"",placeholder:"通过输入通识名称进行搜索","remote-method":t.loadSources,loading:t.options.loading,clearable:""},on:{change:t.selectSource},model:{value:t.post.source_id,callback:function(e){t.$set(t.post,"source_id",e)},expression:"post.source_id"}},t._l(t.options.sources,(function(n){return e("el-option",{key:n.id,attrs:{label:n.name,value:n.id}},[e("div",{staticClass:"u-option"},[e("span",{staticClass:"u-type",domProps:{textContent:t._s(n.label)}}),e("span",{staticClass:"u-name",domProps:{textContent:t._s(n.name)}})])])})),1)]]],2),e("div",{staticClass:"m-publish-remark"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("修订说明 *")]),e("el-input",{attrs:{maxlength:200,minlength:1,"show-word-limit":"",required:"",placeholder:"请简单描述一下本次修订说明"},model:{value:t.post.remark,callback:function(e){t.$set(t.post,"remark",e)},expression:"post.remark"}})],1),e("div",{staticClass:"m-publish-content"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("通识正文 *")]),e("Tinymce",{attrs:{attachmentEnable:!0,resourceEnable:!0,height:600},model:{value:t.post.content,callback:function(e){t.$set(t.post,"content",e)},expression:"post.content"}})],1),e("div",{staticClass:"m-publish-tags"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("通识标签")]),t._l(t.post.tags,(function(n,s){return e("el-tag",{key:s,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.post.tags.splice(s,1)}}},[t._v(t._s(n)+" ")])})),t.inputVisible?e("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small",placeholder:"回车以添加"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):e("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 添加标签 ")])],2),e("div",{staticClass:"m-publish-commit"},[e("el-divider",{attrs:{"content-position":"left"}}),e("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",disabled:t.processing},on:{click:t.handleSubmit}},[t._v("提交通识 ")])],1)])],1)}),[],!1,null,"759cd926",null);e.default=h.exports},d810:function(t,e,n){},ef77:function(t,e,n){"use strict";n("b0c0"),n("14d9");var s={name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}},i=(n("abe2"),n("2877")),o=Object(i.a)(s,(function(){var t=this._self._c;return t("div",{staticClass:"m-publish-header"},[t("el-page-header",{attrs:{content:this.name},on:{back:this.goBack}}),this._t("default")],2)}),[],!1,null,null,null);e.a=o.exports}}]);
//# sourceMappingURL=chunk-d21057b6.4efd4d32.js.map