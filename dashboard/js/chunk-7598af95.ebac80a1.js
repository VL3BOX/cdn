(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7598af95"],{"13d5":function(t,e,n){"use strict";var a=n("23e7"),s=n("d58f").left,i=n("a640"),o=n("2d00"),r=n("605d"),c=!r&&o>79&&o<83,l=c||!i("reduce");a({target:"Array",proto:!0,forced:l},{reduce:function(t){var e=arguments.length;return s(this,t,e,e>1?arguments[1]:void 0)}})},"186b":function(t,e,n){"use strict";n("52d7")},"2ffb":function(t,e,n){},3850:function(t,e,n){"use strict";n("bb61")},"3b94":function(t,e,n){"use strict";n("fc35")},"413a":function(t,e,n){"use strict";n("e573")},4437:function(t){t.exports=JSON.parse('{"e":{"1":"魔盒官网","2":"魔盒移动（小程序/APP）","3":"魔盒助手（客户端）","4":"剑三游戏客户端","5":"剑三游戏插件","6":"其它"},"d":{"1":"Bug异常","2":"建议","3":"举报","4":"其它"},"c":{"0":"待处理","1":"已指派","2":"已处理","3":"已结束"},"b":{"0":"#0366d6","1":"#fba524","2":"#49c10f","3":"#909399"},"a":{"status":[{"text":"待处理","value":0},{"text":"已指派","value":1},{"text":"已处理","value":2},{"text":"已结束","value":3}],"client":[{"text":"重制","value":"std"},{"text":"缘起","value":"origin"}]}}')},"4f31":function(t,e,n){},"52d7":function(t,e,n){},"66e6":function(t,e,n){t.exports=n.p+"img/github.b9f64033.svg"},"703d":function(t,e,n){"use strict";n("2ffb")},"71ab":function(t,e,n){"use strict";n("a033")},"77d7":function(t,e,n){"use strict";n("4f31")},"7ab2":function(t,e,n){"use strict";n("8dd0")},"8dd0":function(t,e,n){},a033:function(t,e,n){},a15b:function(t,e,n){"use strict";var a=n("23e7"),s=n("e330"),i=n("44ad"),o=n("fc6a"),r=n("a640"),c=s([].join),l=i!=Object,u=l||!r("join",",");a({target:"Array",proto:!0,forced:u},{join:function(t){return c(o(this),void 0===t?",":t)}})},b4fa:function(t,e,n){"use strict";n.d(e,"f",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return c})),n.d(e,"d",(function(){return o})),n.d(e,"g",(function(){return l})),n.d(e,"e",(function(){return u}));var a=n("41cb");function s(t){return Object(a["$pay"])().post("/api/im-sure-leave-jx3box",{password:t})}function i(t){return Object(a["$next"])().post("/api/miscfeedback",t)}function o(t){return Object(a["$next"])().get("/api/miscfeedback",{params:t})}function r(t){return Object(a["$next"])().get("/api/miscfeedback/my/list",{params:t})}function c(t){return Object(a["$next"])().get("/api/miscfeedback/".concat(t))}function l(t,e){return Object(a["$next"])().patch("/api/miscfeedback/".concat(t),e)}function u(){return Object(a["$cms"])().get("/api/cms/config/teammates",{params:{status:1}}).then((function(t){return t.data.data}))}},b8d3:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t._self._c;return t.data?e("div",{staticClass:"m-feed-single"},[e("main",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-single-content"},[e("div",{staticClass:"m-type"},[e("span",{staticClass:"u-status",style:{backgroundColor:t.statusColors[t.data.status]}},[t._v(t._s(t.statusMap[t.data.status]))]),e("div",{staticClass:"u-type"},[e("span",{staticClass:"u-value"},[t._v(t._s(t.types[t.data.type]))]),e("span",{staticClass:"u-value"},[t._v(t._s(t.subtypes[t.data.subtype]))])]),t.isTeammate?e("el-button",{attrs:{size:"mini"},on:{click:t.showVisible}},[t._v("处理")]):t._e()],1),e("div",{staticClass:"m-block m-user"},[e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v("提交人：")]),e("a",{staticClass:"u-item u-user",attrs:{href:t.authorLink(t.data.user.id),target:"_blank"}},[e("img",{staticClass:"u-user-avatar",attrs:{src:t.showAvatar(t.data.user.avatar)}}),e("span",{staticClass:"u-user-name"},[t._v(t._s(t.data.user.display_name))])])]),e("span",{staticClass:"u-time u-subblock"},[t._v("提交时间："+t._s(t.formateTime(t.data.created_at)))])]),e("div",{staticClass:"m-block m-dev"},[e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v("分配至：")]),t.data.assign_user&&t.data.assign_user.length?e("div",{staticClass:"u-list u-list-assign"},t._l(t.data.assign_user,(function(n){return e("a",{key:n.id,staticClass:"u-item u-assign",attrs:{href:t.authorLink(n.id),target:"_blank"}},[e("img",{staticClass:"u-assign-avatar",attrs:{src:t.showAvatar(n.avatar)}}),e("span",{staticClass:"u-assign-name"},[t._v(t._s(n.display_name))])])})),0):e("div",{staticClass:"u-list u-list-assign"},[e("a",{staticClass:"u-item u-assign",attrs:{href:t.authorLink(1),target:"_blank"}},[e("img",{staticClass:"u-assign-avatar",attrs:{src:t.showAvatar("https://oss.jx3box.com/upload/avatar/2021/3/18/6568744.png")}}),e("span",{staticClass:"u-assign-name"},[t._v("JX3BOX")])])])]),e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v("关联仓库：")]),e("div",{staticClass:"u-list u-list-repo"},[t.data.repository?e("a",{staticClass:"u-repo u-item",attrs:{href:t.formateGithub(t.data.repository),target:"_blank"}},[e("img",{staticClass:"u-repo-icon",attrs:{src:n("66e6"),alt:""}}),e("span",{staticClass:"u-repo-name"},[t._v(t._s(t.data.repository))])]):e("div",{staticClass:"u-null"},[t._v("-")])])])]),t.data.refer?e("div",{staticClass:"m-block m-refer"},[e("div",{staticClass:"u-subblock"},[e("span",{staticClass:"u-label"},[t._v("来源：")]),e("a",{staticClass:"u-item u-user",attrs:{href:t.data.refer,target:"_blank"}},[t._v(" "+t._s(t.data.refer)+" ")])])]):t._e(),e("div",{staticClass:"m-content m-textarea"},[e("el-divider",{attrs:{"content-position":"left"}},[e("i",{staticClass:"el-icon-edit-outline"}),t._v(" 反馈内容")]),e("div",{staticClass:"u-detail"},[t._v(" "+t._s(t.data.content)+" ")])],1),e("div",{staticClass:"m-attachment m-textarea"},[e("el-divider",{attrs:{"content-position":"left"}},[e("i",{staticClass:"el-icon-picture-outline-round"}),t._v(" 附件截图")]),e("div",{staticClass:"u-detail"},t._l(t.data.images,(function(n,a){return e("div",{key:a,staticClass:"u-img"},[e("el-image",{attrs:{src:n,lazy:"","preview-src-list":t.data.images}})],1)})),0)],1),t.done?e("div",{staticClass:"m-reply"},[e("el-divider",{attrs:{"content-position":"left"}},[e("i",{staticClass:"el-icon-chat-line-square"}),t._v(" 回复处理")]),e("Comment",{attrs:{id:t.id,category:"feedback",order:"desc"}})],1):t._e()]),e("el-dialog",{attrs:{visible:t.visible,title:"处理",width:"750px"},on:{"update:visible":function(e){t.visible=e}}},[e("el-form",{attrs:{model:t.formData,rules:t.rules,"label-position":"top"}},[e("el-form-item",{attrs:{label:"关联处理人"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择关联处理人",filterable:"",multiple:""},model:{value:t.formData.assign,callback:function(e){t.$set(t.formData,"assign",e)},expression:"formData.assign"}},t._l(t.teammates,(function(n){return e("el-option",{key:n.id,attrs:{label:n.teammate_info.display_name,value:n.user_id}},[e("div",{staticClass:"m-teammate"},[e("div",{staticClass:"m-user"},[e("img",{staticClass:"u-avatar",attrs:{src:t.showAvatar(n.teammate_info.user_avatar)}}),e("span",{staticClass:"u-name"},[t._v(t._s(n.teammate_info.display_name))]),e("span",{staticClass:"u-user-id"},[t._v("(ID: "+t._s(n.user_id)+")")])]),e("div",{staticClass:"m-duty"},[n.duty?e("span",{staticClass:"u-duty"},[t._v(t._s(t.formateDuty(n.duty))+" | ")]):t._e(),e("span",{staticClass:"u-remark"},[t._v(t._s(n.remark))])])])])})),1)],1),e("el-form-item",{attrs:{label:"仓库"}},[e("el-input",{attrs:{placeholder:"请输入仓库"},model:{value:t.formData.repository,callback:function(e){t.$set(t.formData,"repository",e)},expression:"formData.repository"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-radio-group",{model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},[e("el-radio-button",{attrs:{label:0}},[t._v("待处理")]),e("el-radio-button",{attrs:{label:1}},[t._v("已指派")]),e("el-radio-button",{attrs:{label:2}},[t._v("已处理")]),e("el-radio-button",{attrs:{label:3}},[t._v("已结束")])],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.visible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)],1)],1):t._e()},s=[],i=n("c7eb"),o=n("1da1"),r=(n("4de4"),n("d3b7"),n("caad"),n("13d5"),n("d81d"),n("b4fa")),c=n("8e44"),l=n("4437"),u=n("85e4"),m=n("c1df"),d=n.n(m),p=function(){var t=this,e=t._self._c;return e("el-container",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-comment"},[e("el-main",[e("CommentInputForm",{on:{submit:t.userSubmitInputForm}}),e("div",{staticClass:"c-comment-order"},[e("span",{staticClass:"u-label"},[t._v("排序模式：")]),e("el-radio-group",{attrs:{size:"mini"},on:{change:t.changeOrder},model:{value:t.isDesc,callback:function(e){t.isDesc=e},expression:"isDesc"}},[e("el-radio-button",{attrs:{label:"DESC"}},[t._v("最后靠前")]),e("el-radio-button",{attrs:{label:"ASC"}},[t._v("最早靠前")])],1)],1),t.isNormal?[t._l(t.commentList,(function(n){return e("div",{key:n.id,staticClass:"c-comment-list"},[e("CommentAvatar",{attrs:{"user-avatar":t._f("showAvatar")(n.avatar),"user-href":t._f("profileLink")(n.userId),username:n.displayName,avatarFrame:n.user_avatar_frame,withFrame:!0,avatarSize:48}}),e("CommentWithReply",{attrs:{"base-api":t.baseAPI,item:n,category:t.category,power:t.commentPower,"user-href":t._f("profileLink")(n.userId),username:n.displayName},on:{deleteComment:t.deleteComment,setTopComment:t.setTopComment,setStarComment:t.setStarComment}})],1)})),e("div",{staticClass:"c-comment-pages"},[t.commentList.length>5?e("CommentInputForm",{attrs:{isBottom:t.commentList.length>5},on:{submit:t.userSubmitInputForm}}):t._e(),e("div",{staticClass:"u-pages"},[e("el-pagination",{staticStyle:{"text-align":"right"},attrs:{background:"","hide-on-single-page":"","current-page":t.pager.index,"page-size":t.pager.pageSize,layout:"prev, pager, next, total",total:t.pager.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pager,"index",e)},"update:current-page":function(e){return t.$set(t.pager,"index",e)}}})],1)],1)]:t._e()],2)],1)},h=[],f=(n("99af"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-comment-avatar"},[e("a",{staticClass:"u-avatar",attrs:{href:t.userHref,target:"_blank"}},[e("el-avatar",{staticClass:"u-avatar-pic",attrs:{shape:"circle",size:t.avatarSize,src:t.userAvatar}}),t.avatarFrame?e("i",{staticClass:"u-avatar-frame",class:36==t.avatarSize?"xxs":"xs"},[e("img",{attrs:{src:t.frameUrl}})]):t._e()],1),e("el-link",{staticClass:"u-name",attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v(t._s(t.username))])],1)}),v=[],g=n("65c2"),b={props:["avatarSize","userAvatar","userHref","username","avatarFrame","withFrame"],data:function(){return{}},computed:{frameUrl:function(){return g["__imgPath"]+"avatar/images/".concat(this.avatarFrame,"/").concat(this.avatarFrame,".svg")}},methods:{},mounted:function(){}},y=b,C=(n("3b94"),n("2877")),w=Object(C["a"])(y,f,v,!1,null,null,null),_=w.exports,x=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-box",attrs:{model:t.newComment}},[e("el-form-item",[e("el-input",{attrs:{rows:"3",type:"textarea",maxlength:"300","show-word-limit":"",placeholder:"参与讨论...",id:t.inputId},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}}),e("div",{staticClass:"c-comment-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}})],1),t.showUploader?e("Uploader",{ref:"uploader",staticClass:"u-uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e(),e("div",{staticClass:"u-toolbar"},[e("el-button",{staticClass:"u-publish",attrs:{type:"primary",disabled:t.disableSubmitBtn},on:{click:t.onSubmit}},[t._v("发表评论")])],1)],1)],1)},k=[],S=(n("a15b"),function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{ref:"upload",attrs:{action:"https://cms.jx3box.com/api/cms/upload","list-type":"picture-card","on-preview":t.handlePictureCardPreview,"auto-upload":!1,"file-list":t.fileList,limit:t.maxCount,accept:t.acceptedExtensions.reduce((function(t,e){return t+".".concat(e,",")}),""),multiple:"","with-credentials":"","on-exceed":t.onExceed,"on-change":t.onChange,"on-success":t.onSuccess,"on-error":t.onError}},[e("i",{staticClass:"el-icon-plus"}),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 最多上传 "+t._s(t.maxCount)+" 张 "+t._s(t.acceptedExtensions.join(" / ").toUpperCase())+" 格式图片，单张图片不能超过 "+t._s(t.maxSize/1024/1024)+" MB ")])]),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"60%",src:t.dialogImageUrl,alt:""}})])],1)}),R=[],I={data:function(){return{dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:2097152}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},onExceed:function(){this.$notify({title:"",message:"最多上传 ".concat(this.maxCount," 张图片！"),type:"error",duration:3e3,position:"bottom-right"})},onChange:function(t,e){"ready"==t.status&&(t.size>this.maxSize?(this.$notify({title:"",message:"单张图片大小不能超过 ".concat(this.maxSize/1024/1024," MB！"),type:"error",duration:3e3,position:"bottom-right"}),e.pop()):this.fileList=e)},upload:function(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess:function(t){this.successList=this.successList.concat(t.data),this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[])},onError:function(){this.$notify({title:"",message:"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]}}},L=I,j=Object(C["a"])(L,S,R,!1,null,null,null),F=j.exports,$=n("c840"),O={components:{Uploader:F,Emotion:$["a"]},props:{isBottom:{type:Boolean,default:!1}},mounted:function(){this.isBottom&&(this.inputId="textarea-bottom")},data:function(){return{showUploader:!1,disableSubmitBtn:!1,newComment:{content:""},inputId:"textarea-top"}},methods:{onSubmit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},attachmentUploadFinish:function(t){this.$emit("submit",{content:this.newComment.content,attachmentList:t}),this.newComment={content:""},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){this.insertVariable(t)},insertVariable:function(t){var e=this;return Object(o["a"])(Object(i["a"])().mark((function n(){var a,s,o,r;return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=document.querySelector("#".concat(e.inputId)),s=t.key,!a.selectionStart&&0!==a.selectionStart){n.next=12;break}return o=a.selectionStart,r=a.selectionEnd,e.newComment.content=a.value.substring(0,o)+s+a.value.substring(r,a.value.length),n.next=8,e.$nextTick();case 8:a.focus(),a.setSelectionRange(r+s.length,r+s.length),n.next=13;break;case 12:e.newComment.content=s;case 13:case"end":return n.stop()}}),n)})))()}}},D=O,U=Object(C["a"])(D,x,k,!1,null,null,null),T=U.exports,P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-comment-cmt"},[e("div",[e("el-link",{staticClass:"u-name",attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v(t._s(t.username||"人字榜800线无名小侠"))]),t.item.is_top?e("span",{staticClass:"u-mark u-top"},[e("i",{staticClass:"el-icon-download"}),t._v("置顶")]):t._e(),t.item.is_star?e("span",{staticClass:"u-mark u-star"},[e("i",{staticClass:"el-icon-star-off"}),t._v("精华")]):t._e()],1),e("CommentContent",{attrs:{date:t.item.commentDate,content:t.item.content,"comment-id":t.item.id,attachments:t._f("stringToArray")(t.item.attachments),"can-delete":t.power.allow||t.power.uid==t.item.userId,"can-set-top":t.power.is_author&&!t.item.is_top,"can-cancel-top":t.power.is_author&&t.item.is_top,"can-set-star":!t.item.is_star&&t.power.group>=64,"can-cancel-star":t.item.is_star&&t.power.group>=64},on:{addNewReply:t.addNewReply,deleteComment:t.deleteComment,setTopComment:t.setTopComment,setStarComment:t.setStarComment}}),e("ReplyList",{attrs:{data:t.replyList,pager:t.pager,power:t.power},on:{addNewReply:t.addNewReply,deleteReply:t.deleteReply,goto:t.gotoReplyListIndex,resetReply:t.resetReply}})],1)},E=[],A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-cmt"},[""!=t.content?e("div",{staticClass:"u-text",domProps:{innerHTML:t._s(t.formatContent(t.content))}}):t._e(),t.attachments.length?e("div",{staticClass:"u-attachements"},t._l(t.attachments,(function(n){return e("el-image",{key:n,attrs:{src:t._f("showAttachment")(n),"preview-src-list":[t.showPreview(n)],lazy:""}})})),1):t._e(),e("div",{staticClass:"u-toolbar"},[e("el-button",{staticClass:"u-admin",attrs:{type:"text",size:"mini",icon:"el-icon-chat-round"},on:{click:function(e){t.showForm=!t.showForm}}},[t._v("回复")]),t.canDelete?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteComment()}}},[t._v("删除")]):t._e(),t.canSetTop?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-top",size:"mini"},on:{click:function(e){return t.topComment(!0)}}},[t._v("置顶")]):t._e(),t.canCancelTop?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-top",size:"mini"},on:{click:function(e){return t.topComment(!1)}}},[t._v("取消置顶")]):t._e(),t.canSetStar?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-star-off",size:"mini"},on:{click:function(e){return t.starComment(!0)}}},[t._v("加精")]):t._e(),t.canCancelStar?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-star-on",size:"mini"},on:{click:function(e){return t.starComment(!1)}}},[t._v("取消加精")]):t._e(),e("time",{staticClass:"u-date"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dataFormat(t.date))+" ")])],1),t.showForm?e("el-form",{ref:"form",staticClass:"c-comment-subbox",attrs:{model:t.newComment}},[e("el-form-item",[e("el-input",{attrs:{type:"textarea",placeholder:"参与评论...",id:"id"+t.inputId},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}})],1),e("el-form-item",[e("div",{staticClass:"c-comment-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}})],1),t.showUploader?e("Uploader",{ref:"uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1),e("el-form-item",[e("el-button",{attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submit()}}},[t._v("提交")]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.showForm=!1}}},[t._v("收起")])],1)],1):t._e()],1)},z=[],B=n("506c");function N(t){return t.replace(/[<>"']/g,(function(t){switch(t){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;"}}))}function M(t){const e=new B["a"](N(t));return e.code}function H(t){return t>9?t:"0".concat(t)}var J={props:["content","date","hasReply","canDelete","canSetTop","canCancelTop","canSetStar","canCancelStar","attachments","commentId"],components:{Uploader:F,Emotion:$["a"]},data:function(){return{newComment:{content:""},showForm:!1,disableSubmitBtn:!1,showUploader:!1,inputId:"",previewList:[]}},mounted:function(){this.commentId&&(this.inputId=this.commentId)},computed:{_attachments:function(){return this.attachments.map((function(t){return Object(u["resolveImagePath"])(t)}))}},methods:{topComment:function(t){this.$emit("setTopComment",t)},starComment:function(t){this.$emit("setStarComment",t)},deleteComment:function(){var t=this;this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("deleteComment")})).catch((function(){}))},dataFormat:function(t){var e=new Date(t);return e.getFullYear()+"-"+H(e.getMonth()+1)+"-"+H(e.getDate())+" "+H(e.getHours())+":"+H(e.getMinutes())+":"+H(e.getSeconds())},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("addNewReply",{content:this.newComment.content,attachmentList:t}),this.showUploader=!1,this.newComment={content:""}},attachmentUplodError:function(){this.disableSubmitBtn=!1},submit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){},formatContent:M,handleEmotionSelected:function(t){var e=this;return Object(o["a"])(Object(i["a"])().mark((function n(){var a,s,o,r;return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=document.querySelector("#id".concat(e.inputId)),s=t.key,!a.selectionStart&&0!==a.selectionStart){n.next=12;break}return o=a.selectionStart,r=a.selectionEnd,e.newComment.content=a.value.substring(0,o)+s+a.value.substring(r,a.value.length),n.next=8,e.$nextTick();case 8:a.focus(),a.setSelectionRange(r+s.length,r+s.length),n.next=13;break;case 12:e.newComment.content=s;case 13:case"end":return n.stop()}}),n)})))()},showPreview:function(t){return Object(u["resolveImagePath"])(t)}},filters:{showAttachment:function(t){return Object(u["resolveImagePath"])(t)+"?x-oss-process=style/comment_thumb"}}},V=J,Y=(n("413a"),Object(C["a"])(V,A,z,!1,null,null,null)),q=Y.exports,X=function(){var t=this,e=t._self._c;return t.data.length?e("div",{staticClass:"c-comment-replylist"},[t._l(t.data,(function(n){return e("reply-item",{key:n.id,staticClass:"c-comment-reply",attrs:{reply:n,power:t.power},on:{deleteReply:t.deleteReply,addReply:t.addReply}})})),t.data.length>=3||t.showPager?e("el-row",[e("el-col",{attrs:{span:4}},[e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.showPager,expression:"showPager"}],attrs:{type:"text"},on:{click:function(e){return t.showLess()}}},[t._v("收起")]),e("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.showPager,expression:"!showPager"}],attrs:{type:"text"},on:{click:function(e){return t.showMore()}}},[t._v("查看更多")])],1),e("el-col",{staticClass:"c-comment-reply-pages",attrs:{span:20}},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPager,expression:"showPager"}],attrs:{small:"","current-page":t.pager.index,"page-size":t.pager.pageSize,layout:"total, prev, pager, next",total:t.pager.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pager,"index",e)},"update:current-page":function(e){return t.$set(t.pager,"index",e)}}})],1)],1):t._e()],2):t._e()},G=[],W=function(){var t=this,e=t._self._c;return e("el-row",[e("CommentAvatar",{attrs:{"user-avatar":t._f("showAvatar")(t.reply.avatar),"user-href":t._f("profileLink")(t.reply.userId),username:t.reply.displayName,avatarFrame:t.reply.user_avatar_frame,avatarSize:36}}),e("CommentContentSimple",{attrs:{"comment-id":t.reply.id,date:t.reply.commentDate,content:t.reply.content,attachments:t._f("stringToArray")(t.reply.attachments),"can-delete":t.power.allow||t.power.uid==t.reply.userId,"can-reply":t.power.uid!=t.reply.userId,"user-href":t._f("profileLink")(t.reply.replyForUID),"reply-for-username":t.reply.replyForUsername,"reply-for-user-id":t.reply.replyForUID},on:{delete:t.deleteReply,showReplyInput:function(e){t.showReplyForReplyFrom=!t.showReplyForReplyFrom}}}),t.showReplyForReplyFrom?e("ReplyForReply",{attrs:{username:t.reply.displayName,"user-href":t._f("profileLink")(t.reply.userId),"current-id":t.reply.id},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1)},K=[],Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-reply"},[e("div",{staticClass:"u-reply-content"},[0!=t.replyForUserId?e("span",{staticClass:"u-reply-label"},[t._v(" 回复 "),e("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("@"+t._s(t.replyForUsername))]),t._v(" : ")],1):t._e(),e("div",{staticClass:"u-reply-text",domProps:{innerHTML:t._s(t.formatContent(t.content))}})]),t.attachments.length?e("div",{staticClass:"u-attachements"},t._l(t.attachments,(function(n){return e("el-image",{key:n,attrs:{src:t._f("showAttachment")(n),"preview-src-list":[t.showPreview(n)],lazy:""}})})),1):t._e(),e("div",{staticClass:"u-toolbar"},[t.canReply?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-chat-line-round",size:"mini"},on:{click:function(e){return t.showReplyForReplyInput()}}},[t._v("回复")]):t._e(),t.canDelete?e("el-button",{staticClass:"u-admin",attrs:{type:"text",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.deleteComment()}}},[t._v("删除")]):t._e(),e("time",{staticClass:"u-date"},[e("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dataFormat(t.date))+" ")])],1)])},Z=[];function tt(t){return t>9?t:"0".concat(t)}var et={props:["commentId","content","attachments","date","hasReply","canDelete","canReply","userHref","replyForUsername","replyForUserId"],data:function(){return{showInput:!1}},computed:{_attachments:function(){return this.attachments.map((function(t){return Object(u["resolveImagePath"])(t)}))}},filters:{profileLink:function(t){return Object(u["authorLink"])(t)},showAttachment:function(t){return Object(u["resolveImagePath"])(t)+"?x-oss-process=style/comment_thumb"}},methods:{formatContent:M,getPList:function(t){return t.split("\n")},deleteComment:function(){var t=this;this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("delete",t.commentId)})).catch((function(){}))},dataFormat:function(t){var e=new Date(t);return e.getFullYear()+"-"+tt(e.getMonth()+1)+"-"+tt(e.getDate())+" "+tt(e.getHours())+":"+tt(e.getMinutes())+":"+tt(e.getSeconds())},showReplyForReplyInput:function(){this.$emit("showReplyInput")},previewImg:function(t){this.$hevueImgPreview({multiple:!0,nowImgIndex:t,imgList:this._attachments,controlBar:!1,clickMaskCLose:!0})},showPreview:function(t){return Object(u["resolveImagePath"])(t)}}},nt=et,at=(n("77d7"),Object(C["a"])(nt,Q,Z,!1,null,null,null)),st=at.exports,it=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-subbox"},[e("div",{staticClass:"u-subbox-label"},[t._v(" 回复 "),e("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("＠"+t._s(t.username))]),t._v(" ： ")],1),e("el-form-item",[e("el-input",{attrs:{type:"textarea",id:"id"+t.inputId,placeholder:"输入回复..."},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),e("el-form-item",[e("div",{staticClass:"c-comment-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}})],1),t.showUploader?e("Uploader",{ref:"uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1),e("el-form-item",[e("el-button",{attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submintReply()}}},[t._v("提交")]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.hideForm()}}},[t._v("收起")])],1)],1)},ot=[],rt={props:["username","userHref","currentId"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1,inputId:""}},components:{Uploader:F,Emotion:$["a"]},mounted:function(){this.currentId&&(this.inputId=this.currentId)},methods:{submintReply:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){this.$emit("hideForm")},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:t}),this.content="",this.showUploader=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){var e=this;return Object(o["a"])(Object(i["a"])().mark((function n(){var a,s,o,r;return Object(i["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=document.querySelector("#id".concat(e.inputId)),s=t.key,!a.selectionStart&&0!==a.selectionStart){n.next=12;break}return o=a.selectionStart,r=a.selectionEnd,e.content=a.value.substring(0,o)+s+a.value.substring(r,a.value.length),n.next=8,e.$nextTick();case 8:a.focus(),a.setSelectionRange(r+s.length,r+s.length),n.next=13;break;case 12:e.content=s;case 13:case"end":return n.stop()}}),n)})))()}}},ct=rt,lt=(n("703d"),Object(C["a"])(ct,it,ot,!1,null,null,null)),ut=lt.exports,mt={props:["reply","power"],components:{CommentAvatar:_,CommentContentSimple:st,ReplyForReply:ut},backReplyList:[],data:function(){return{showReplyForReplyFrom:!1}},filters:{profileLink:function(t){return Object(u["authorLink"])(t)},stringToArray:function(t){return t?JSON.parse(t):[]},showAvatar:function(t){return Object(u["showAvatar"])(t,84)}},methods:{deleteReply:function(t){this.$emit("deleteReply",t)},doReply:function(t){t.replyForUID=this.reply.userId,t.replyForCommentId=this.reply.id,this.$emit("addReply",t),this.showReplyForReplyFrom=!1}}},dt=mt,pt=Object(C["a"])(dt,W,K,!1,null,null,null),ht=pt.exports,ft={props:["data","power","pager"],components:{ReplyItem:ht},data:function(){return{showPager:!1}},filters:{profileLink:function(t){return Object(u["authorLink"])(t)}},methods:{showMore:function(){this.showPager=!0,this.$emit("goto",1)},showLess:function(){this.showPager=!1,this.$emit("resetReply")},handleCurrentChange:function(t){this.$emit("goto",t)},deleteReply:function(t){this.$emit("deleteReply",t)},addReply:function(t){this.$emit("addNewReply",t)}}},vt=ft,gt=(n("186b"),Object(C["a"])(vt,X,G,!1,null,null,null)),bt=gt.exports,yt=n("5c96");const Ct=function(t,e){let n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};return St(t,e,n)};var wt={};const _t=function(t,e,n){if(wt[t])if(Date.now()-wt[t].lastest<6e4){if(wt[t].count>=6)return yt["Notification"].warning({title:"系统",message:"你单身多久了? 动作这么快, 系统处理不过来 ( T_T )",duration:3e3,position:"bottom-right"}),new Promise((t,e)=>{e()});wt[t].count=wt[t].count+1}else Date.now()-wt[t].lastest>6e4&&(wt[t]={lastest:Date.now(),count:0});else wt[t]={lastest:Date.now(),count:0};let a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return St(t,e,a)},xt=function(t,e,n){let a={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return St(t,e,a)},kt=function(t,e){let n={method:"DELETE"};return St(t,e,n)};function St(t,e,n){let a=g["__next"];if("/"==a[a.length-1]&&(a=a.substring(0,a.length-1)),t=a+t,n.credentials="include",e){let n=[];Object.keys(e).forEach(t=>{n.push(t+"="+e[t])});let a=g["__next"];"/"==a[a.length-1]&&(a=a.substring(0,a.length-1)),t=t+"?"+n.join("&")}return fetch(t,n).then(t=>{switch(t.status){case 200:break;case 401:throw window.location.href=g["__Links"].account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 403:throw window.location.href=g["__Links"].account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 423:throw window.location.href=g["__Links"].account.email_verify+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+t.statusText);case 406:throw t.text().then(t=>{yt["Notification"].warning({title:"系统",message:t||"提交内容不合法,请重新提交",duration:3e3,position:"bottom-right"})}),new Error("错误:"+t.statusText);default:throw t.text().then(e=>{yt["Notification"].error({title:"系统:"+t.statusText,message:e||"系统错误,请稍后重试!",duration:3e3,position:"bottom-right"})}),new Error("错误:"+t.statusText)}let e=t.headers.get("Content-Type");switch(e=e&&e.split(";").shift(),e){case"application/json":return t.json();default:return t.text()}})}var Rt={props:["item","baseApi","power","user-href","username"],components:{CommentContent:q,ReplyList:bt},data:function(){return{replyList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0}}},filters:{stringToArray:function(t){return t?JSON.parse(t):[]}},created:function(){this.replyList=this.item.reply||[]},methods:{deleteComment:function(){this.$emit("deleteComment",this.item.id)},setTopComment:function(t){this.$emit("setTopComment",this.item.id,t)},setStarComment:function(t){this.$emit("setStarComment",this.item.id,t)},addNewReply:function(t){var e=this;_t("".concat(this.baseApi,"/comment/").concat(this.item.id,"/reply"),null,t).then((function(){e.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),e.loadReplyList(e.pager.index)})).catch((function(){}))},deleteReply:function(t){var e=this;kt("".concat(this.baseApi,"/comment/").concat(t)).then((function(){e.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),e.loadReplyList(e.pager.index)})).catch((function(){}))},gotoReplyListIndex:function(t){this.loadReplyList(t,6)},loadReplyList:function(t,e){var n=this;Ct("".concat(this.baseApi,"/comment/").concat(this.item.id,"/reply/page/").concat(t,"?pageSize=").concat(e)).then((function(a){1==t&&3==e&&(n.item.reply=a.data||[]),n.replyList=a.data||[],n.pager=a.page})).catch((function(){}))},resetReply:function(){this.loadReplyList(1,3)}}},It=Rt,Lt=(n("71ab"),Object(C["a"])(It,P,E,!1,null,null,null)),jt=Lt.exports,Ft=n("41cb"),$t=n("c9d2");const Ot="cmt_order";async function Dt(){return $t["a"].isLogin()?Object(Ft["$cms"])({mute:!0}).get("/api/cms/user/conf",{params:{key:Ot}}).then(t=>t.data.data):new Promise(t=>{const e=localStorage.getItem(Ot)||"DESC";t(e)})}async function Ut(t){return $t["a"].isLogin()?Object(Ft["$cms"])().post("/api/cms/user/conf",{val:t},{params:{key:Ot}}).then(t=>t.data.data):new Promise(e=>{e(localStorage.setItem(Ot,t))})}var Tt={name:"Comment",props:["id","category","normal","order"],components:{CommentAvatar:_,CommentWithReply:jt,CommentInputForm:T},data:function(){return{baseAPI:"",commentPower:{allow:!1,uid:-1},commentList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0},isDesc:"DESC",loading:!1}},computed:{isNormal:function(){return void 0===this.normal||this.normal}},methods:{changeOrder:function(){this.reloadCommentList(this.pager.index),Ut(this.isDesc?"DESC":"ASC")},setTopComment:function(t,e){var n=this,a=e?"set":"cancel";xt("".concat(this.baseAPI,"/comment/").concat(t,"/top/").concat(a)).then((function(){n.reloadCommentList(n.pager.index)})).catch((function(){}))},setStarComment:function(t,e){var n=this,a=e?"set":"cancel";xt("".concat(this.baseAPI,"/comment/").concat(t,"/star/").concat(a)).then((function(){n.reloadCommentList(n.pager.index)})).catch((function(){}))},deleteComment:function(t){var e=this;kt("".concat(this.baseAPI,"/comment/").concat(t)).then((function(){e.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),e.reloadCommentList(e.pager.index)})).catch((function(){}))},reloadCommentList:function(t){var e=this;this.loading=!0;var n={};"DESC"===this.isDesc&&(n["desc"]=!0),Ct("".concat(this.baseAPI,"/comment/page/").concat(t),n).then((function(t){e.commentList=t.data||[],e.pager=t.page})).catch((function(){})).finally((function(){e.loading=!1}))},handleCurrentChange:function(t){this.reloadCommentList(t)},userSubmitInputForm:function(t){var e=this;_t("".concat(this.baseAPI,"/comment"),null,t).then((function(t){t&&~~t.code>0?e.$notify({title:"评论失败",message:t.msg||"",type:"error",duration:3e3,position:"bottom-right"}):(e.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),1==e.pager.index&&e.reloadCommentList(e.pager.index))})).catch((function(){}))}},filters:{profileLink:function(t){return Object(u["authorLink"])(t)},showAvatar:function(t){return Object(u["showAvatar"])(t,144)}},created:function(){this.baseAPI="/api/comment/".concat(this.category,"/article/").concat(this.id)},mounted:function(){var t=this;Dt().then((function(e){t.isDesc=e})).then((function(){Ct("".concat(t.baseAPI,"/i-am-author")).then((function(e){t.commentPower=e})).catch((function(){}))})).finally((function(){t.reloadCommentList(1)}))}},Pt=Tt,Et=(n("3850"),Object(C["a"])(Pt,p,h,!1,null,null,null)),At=Et.exports,zt={name:"FeedbackSingle",components:{Comment:At},data:function(){return{data:"",loading:!1,types:l["e"],subtypes:l["d"],statusMap:l["c"],statusColors:l["b"],done:!1,visible:!1,formData:{assign:[],repository:"",status:0},rules:{},teammates:[]}},computed:{id:function(){return this.$route.params.id},isTeammate:function(){return this.$store.state.isTeammate}},watch:{id:{immediate:!0,handler:function(t){t&&this.getData()}}},mounted:function(){this.loadTeammates()},methods:{getData:function(){var t=this;return Object(o["a"])(Object(i["a"])().mark((function e(){var n,a,s,o,c;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,Object(r["b"])(t.id);case 4:c=e.sent,t.data=c.data.data,t.formData.repository=(null===(n=t.data)||void 0===n?void 0:n.repository)||"",t.formData.assign=(null===(a=t.data)||void 0===a||null===(s=a.assign)||void 0===s?void 0:s.filter((function(t){return t})))||[],t.formData.status=(null===(o=t.data)||void 0===o?void 0:o.status)||0,t.done=!0,e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](0),console.log(e.t0);case 15:return e.prev=15,t.loading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})))()},loadTeammates:function(){var t=this;return Object(o["a"])(Object(i["a"])().mark((function e(){var n;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c["c"])();case 3:n=e.sent,t.teammates=n.data.data.filter((function(t){return t.group&&["mp","developer","designer"].includes(t.group)})),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},back:function(){this.$router.go(-1)},authorLink:u["authorLink"],showAvatar:u["showAvatar"],formateTime:function(t){return d()(t).format("YYYY-MM-DD HH:mm:ss")},formateGithub:function(t){return"https://github.com/JX3BOX/".concat(t)},formateDuty:function(t){return t&&t.reduce((function(t,e){return t+" | "+e}))||""},confirm:function(){var t=this;Object(r["g"])(this.id,{assign:this.formData.assign.map((function(t){return t})),repository:this.formData.repository,status:this.formData.status}).then((function(e){t.$message.success("处理成功"),t.visible=!1,t.getData()})).catch((function(e){t.$message.error(e.message)}))},showVisible:function(){var t,e;this.formData.repository=this.data.repository,this.formData.assign=(null===(t=this.data)||void 0===t||null===(e=t.assign)||void 0===e?void 0:e.filter((function(t){return t})))||[],this.visible=!0}}},Bt=zt,Nt=(n("7ab2"),Object(C["a"])(Bt,a,s,!1,null,null,null));e["default"]=Nt.exports},bb61:function(t,e,n){},d58f:function(t,e,n){var a=n("59ed"),s=n("7b0b"),i=n("44ad"),o=n("07fa"),r=TypeError,c=function(t){return function(e,n,c,l){a(n);var u=s(e),m=i(u),d=o(u),p=t?d-1:0,h=t?-1:1;if(c<2)while(1){if(p in m){l=m[p],p+=h;break}if(p+=h,t?p<0:d<=p)throw r("Reduce of empty array with no initial value")}for(;t?p>=0:d>p;p+=h)p in m&&(l=n(l,m[p],p,u));return l}};t.exports={left:c(!1),right:c(!0)}},e573:function(t,e,n){},fc35:function(t,e,n){}}]);
//# sourceMappingURL=chunk-7598af95.ebac80a1.js.map